@model MusicPlaylistWeb.Models.Song
@{
    ViewData["Title"] = "Agregar Canci√≥n";
}

<h1>‚ûï Agregar Nueva Canci√≥n</h1>

<div class="info-box">
    <div class="info-box-title">
        <span class="info-box-icon">üìù</span>
        Operaci√≥n 3: Insertar un elemento en el √°rbol
    </div>
    <div class="info-box-content">
        <strong>M√©todo C#:</strong> <code>Insertar(Song cancion)</code> - Retorna <code>bool</code><br>
        <strong>Complejidad:</strong> O(log n) promedio | <strong>Validaciones:</strong> ID √∫nico, datos v√°lidos<br>
        <strong>Descripci√≥n:</strong> Agrega una nueva canci√≥n al √°rbol manteniendo la propiedad de ABB (menores a la izquierda, mayores a la derecha)
    </div>
</div>

<div class="card">
    <form asp-action="Agregar" method="post" id="formAgregar">
        <div class="form-group">
            <label class="form-label" for="Id">ID *</label>
            @if (ViewBag.IdSugerido != null)
            {
                <div class="id-suggestion">
                    üí° ID sugerido: <strong>@ViewBag.IdSugerido</strong> (puedes usar otro)
                </div>
            }
            <input type="number" 
                   class="form-control" 
                   id="Id" 
                   name="Id" 
                   value="@ViewBag.IdSugerido"
                   required 
                   min="1" 
                   max="999999"
                   step="1"
                   pattern="[0-9]+"
                   title="Solo n√∫meros enteros positivos"
                   placeholder="Ej: 1, 5, 100" />
            <small class="form-text">Solo n√∫meros enteros positivos (sin decimales ni letras)</small>
        </div>

<style>
.id-suggestion {
    background: linear-gradient(135deg, rgba(29, 185, 84, 0.1), rgba(29, 185, 84, 0.2));
    border-left: 4px solid #1DB954;
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    border-radius: 6px;
    color: #e0e0e0;
    font-size: 0.95rem;
}

.id-suggestion strong {
    color: #1DB954;
    font-size: 1.1rem;
}
</style>

        <div class="form-group">
            <label class="form-label" for="Titulo">T√≠tulo *</label>
            <input type="text" 
                   class="form-control" 
                   id="Titulo" 
                   name="Titulo" 
                   required 
                   minlength="1"
                   maxlength="100"
                   pattern=".*\S+.*"
                   title="El t√≠tulo no puede estar vac√≠o o contener solo espacios"
                   placeholder="Ej: Bohemian Rhapsody" />
            <small class="form-text">Texto (1-100 caracteres, no puede estar vac√≠o)</small>
        </div>

        <div class="form-group">
            <label class="form-label" for="Artista">Artista *</label>
            <input type="text" 
                   class="form-control" 
                   id="Artista" 
                   name="Artista" 
                   required 
                   minlength="1"
                   maxlength="100"
                   pattern=".*\S+.*"
                   title="El artista no puede estar vac√≠o o contener solo espacios"
                   placeholder="Ej: Queen" />
            <small class="form-text">Texto (1-100 caracteres, no puede estar vac√≠o)</small>
        </div>

        <div class="form-group">
            <label class="form-label" for="Duracion">Duraci√≥n (segundos) *</label>
            <input type="number" 
                   class="form-control" 
                   id="Duracion" 
                   name="Duracion" 
                   required 
                   min="1" 
                   max="7200"
                   step="1"
                   pattern="[0-9]+"
                   title="Solo n√∫meros enteros positivos (1-7200 segundos = 2 horas)"
                   placeholder="Ej: 180 (3 minutos)" />
            <small class="form-text">Solo n√∫meros enteros de 1 a 7200 segundos (sin decimales)</small>
        </div>

        <div class="form-group">
            <label class="form-label" for="Popularidad">Popularidad (0-100) *</label>
            <input type="number" 
                   class="form-control" 
                   id="Popularidad" 
                   name="Popularidad" 
                   required 
                   min="0" 
                   max="100"
                   step="1"
                   pattern="[0-9]{1,3}"
                   title="Solo n√∫meros enteros entre 0 y 100"
                   placeholder="Ej: 95" />
            <small class="form-text">Solo n√∫meros enteros de 0 a 100 (sin decimales)</small>
        </div>

        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary">Agregar Canci√≥n</button>
            <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // Validaci√≥n adicional en JavaScript
        document.getElementById('formAgregar').addEventListener('submit', function(e) {
            const id = document.getElementById('Id').value;
            const titulo = document.getElementById('Titulo').value;
            const artista = document.getElementById('Artista').value;
            const duracion = document.getElementById('Duracion').value;
            const popularidad = document.getElementById('Popularidad').value;

            // Validar que ID sea n√∫mero entero positivo
            if (!/^\d+$/.test(id) || parseInt(id) <= 0) {
                e.preventDefault();
                alert('‚ùå El ID debe ser un n√∫mero entero positivo (sin decimales ni letras).\nEjemplo: 1, 5, 100');
                return false;
            }

            // Validar que t√≠tulo no est√© vac√≠o
            if (titulo.trim().length === 0) {
                e.preventDefault();
                alert('‚ùå El t√≠tulo no puede estar vac√≠o o contener solo espacios.');
                return false;
            }

            // Validar que artista no est√© vac√≠o
            if (artista.trim().length === 0) {
                e.preventDefault();
                alert('‚ùå El artista no puede estar vac√≠o o contener solo espacios.');
                return false;
            }

            // Validar que duraci√≥n sea n√∫mero entero positivo
            if (!/^\d+$/.test(duracion) || parseInt(duracion) <= 0 || parseInt(duracion) > 7200) {
                e.preventDefault();
                alert('‚ùå La duraci√≥n debe ser un n√∫mero entero positivo entre 1 y 7200 segundos (sin decimales).\nEjemplo: 180 (3 minutos)');
                return false;
            }

            // Validar que popularidad est√© en rango
            if (!/^\d+$/.test(popularidad) || parseInt(popularidad) < 0 || parseInt(popularidad) > 100) {
                e.preventDefault();
                alert('‚ùå La popularidad debe ser un n√∫mero entero entre 0 y 100 (sin decimales).\nEjemplo: 95');
                return false;
            }

            return true;
        });

        // Prevenir entrada de letras en campos num√©ricos
        const camposNumericos = ['Id', 'Duracion', 'Popularidad'];
        camposNumericos.forEach(function(campo) {
            document.getElementById(campo).addEventListener('keypress', function(e) {
                // Solo permitir n√∫meros (0-9)
                if (e.key < '0' || e.key > '9') {
                    e.preventDefault();
                }
            });

            // Prevenir pegar texto no num√©rico
            document.getElementById(campo).addEventListener('paste', function(e) {
                const pasteData = e.clipboardData.getData('text');
                if (!/^\d+$/.test(pasteData)) {
                    e.preventDefault();
                    alert('‚ùå Solo se permiten n√∫meros enteros en este campo.');
                }
            });
        });
    </script>
}

<style>
    .form-text {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: var(--spotify-light-gray);
    }

    .form-control:invalid {
        border-color: #ff3b30;
    }

    .form-control:valid {
        border-color: var(--spotify-green);
    }
</style>
